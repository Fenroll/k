<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendar</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  
  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
  
  <script src="schedule-data.js"></script>
  <style>
  body { background: #f5f5f5; font-family: 'Open Sans', Arial, sans-serif; margin: 0; }
  .layout { display: flex; min-height: 100vh; }
  
  /* Sidebar styling */
  #side-menu {
    background: #262626;
    width: 200px;
    min-width: 200px;
    max-width: 200px;
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    z-index: 100;
  }
  
 .logo-header {
      background: #262626;
      width: 200px !important;
      height: 107px !important;
      min-width: 200px !important;
      min-height: 107px !important;
      max-width: 200px !important;
      max-height: 107px !important;
      text-align: center;
      border-bottom: none;
      margin: 0 !important;
      padding: 0 !important;
      overflow: hidden;
      flex: 0 0 107px !important;
      box-sizing: content-box;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 2px solid #1d1b1b;
    }
  
  .logo-img {
    width: 168px !important;
    height: 22.55px !important;
    object-fit: contain;
    margin-top: 4px;  /* –î–æ–±–∞–≤–µ–Ω–æ –∑–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ—Ç–æ –∫–∞—Ç–æ –≤ index.html */
  }
  
  .sidebar-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .sidebar-nav a {
    display: flex;
    align-items: center;
    color: #fff !important;
    text-decoration: none;
    padding: 16px 28px 16px 12px;  /* –ù–∞–º–∞–ª–µ–Ω padding-left –Ω–∞ 20px */
    font-size: 14px;
    transition: background 0.2s;
    gap: 12px;
    background: transparent;
    font-weight: 400;
    position: relative;
    border-radius: 0;
    flex-direction: row;
  }
  
  .sidebar-nav .active a {
    background: #000000;
  }
  
  .sidebar-nav .active a::before {
    content: '';
    display: block;
    position: absolute;
    left: 0;
    top: 0;
    width: 4px;
    height: 100%;
    background: #C56FD5;
  }
  
  .sidebar-nav a:hover {
    background: #181818;  /* –¢—ä–º–Ω–æ —Å–∏–≤–æ –ø—Ä–∏ hover */
  }
  
  .sidebar-nav .svg-icon {
    width: 26px;
    height: 26px;
    flex-shrink: 0;
    margin-right: -2px;
    margin-left: -2px;
    margin-top: -2px;
    margin-bottom: -2px;
  }
  
  .sidebar-footer-links {
    position: absolute;
    left: 12px;
    bottom: 11px;
    display: flex;
    flex-direction: column;
    gap: 2.5px;
    font-size: 12px;
    color: #cdcdcd;
  }
  
  .sidebar-footer-item {
    font-size: 12px;
    color: #cdcdcd;
    cursor: default;
  }
  
  /* Main content */
  .main-content {
    flex: 1;
    padding: 0 0 0 200px;
    background: #f5f5f5;
    min-height: 100vh;
  }
  
  .main-header {
    background: #fff;
    color: #000;
    width: 100%;
    height: 107px;
    display: flex;
    align-items: center;
    border-bottom: 1px solid #d3cdcd;
  }
  
  .page-title {
    font-size: 30px !important;
    margin-left: 30px !important;
    font-family: 'Noto Serif', serif;
    font-weight: 400;  /* –ü—Ä–æ–º–µ–Ω–µ–Ω–æ –æ—Ç 700 (bold) –Ω–∞ 400 (normal) */
  }
  
  /* Schedule container */
  .schedule-container {
    margin: 2rem 33px;
  }
  
  /* Current Information Panel */
  .info-panel {
    background: #fff;
    border-radius: 8px;
    padding: 24px;
    margin-top: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  
  .info-panel-content {
    color: #374151;
    line-height: 1.6;
  }
  
  .info-panel-content h1 {
    font-size: 24px;
    color: #111827;
    margin: 0 0 16px 0;
    font-weight: 600;
  }
  
  .info-panel-content h2 {
    font-size: 20px;
    color: #1f2937;
    margin: 24px 0 12px 0;
    font-weight: 600;
  }
  
  .info-panel-content h3 {
    font-size: 16px;
    color: #7c3aed;
    margin: 16px 0 8px 0;
    font-weight: 600;
  }
  
  .info-panel-content p {
    margin: 8px 0;
  }
  
  .info-panel-content ul {
    margin: 8px 0;
    padding-left: 24px;
  }
  
  .info-panel-content li {
    margin: 4px 0;
  }
  
  .info-panel-content strong {
    color: #111827;
    font-weight: 600;
  }
  
  .info-panel-content hr {
    border: none;
    border-top: 1px solid #e5e7eb;
    margin: 24px 0;
  }
  
  .info-panel-content code {
    background: #f3f4f6;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
  }
  
  /* Week selector */
  .week-selector {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-bottom: 24px;
    background: #fff;
    padding: 16px 24px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  
  .week-btn {
    background: #7c3aed;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .week-btn:hover {
    background: #6d28d9;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(124,58,237,0.3);
  }
  
  .week-btn:disabled {
    background: #d1d5db;
    cursor: not-allowed;
    transform: none;
  }
  
  .week-info {
    font-size: 16px;
    font-weight: 600;
    color: #374151;
    min-width: 280px;
    text-align: center;
  }
  
  .week-number {
    color: #7c3aed;
    font-size: 14px;
    display: block;
    margin-top: 4px;
  }
  
  /* Schedule table */
  .schedule-table {
    width: 100%;
    background: #fff;
    border-collapse: collapse;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border-radius: 8px;
    overflow: hidden;
    table-layout: fixed; /* –§–∏–∫—Å–∏—Ä–∞ —à–∏—Ä–æ—á–∏–Ω–∞—Ç–∞ –Ω–∞ –∫–æ–ª–æ–Ω–∏—Ç–µ */
  }
  
  .schedule-table thead th {
    background: #7c3aed;
    color: #fff;
    padding: 16px 12px;
    text-align: center;
    font-weight: 600;
    font-size: 15px;
    border-right: 1px solid #6d28d9;
  }
  
  .schedule-table thead th .date-label {
    display: block;
    font-size: 12px;
    font-weight: 400;
    margin-top: 4px;
    opacity: 0.9;
  }
  
  .schedule-table thead th:last-child {
    border-right: none;
  }
  
  .schedule-table tbody td {
    padding: 8px;
    border: 1px solid #e5e7eb;
    text-align: center;
    vertical-align: top;
    min-height: 80px;
    width: 20%; /* –í—Å—è–∫–∞ –∫–æ–ª–æ–Ω–∞ –µ 20% (5 –∫–æ–ª–æ–Ω–∏ = 100%) */
  }
  
  /* Schedule item card */
  .schedule-item {
    border-radius: 6px;
    padding: 8px 10px;
    margin-bottom: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  
  /* –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ - vibrant blue */
  .schedule-item.type-exercise {
    background: linear-gradient(135deg, #dbeafe 0%, #91c3fd 100%);
    border-left: 4px solid #2563eb;
  }
  
  .schedule-item.type-exercise:hover {http://127.0.0.1:5500/calendar.html
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(37,99,235,0.35);
  }
  
  .schedule-item.type-exercise .schedule-subject {
    color: #1e40af;
  }
  
  /* –õ–µ–∫—Ü–∏—è - boring/neutral colors */
  .schedule-item.type-lecture {
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
    border-left: 4px solid #9ca3af;
  }
  
  .schedule-item.type-lecture:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(156,163,175,0.25);
  }
  
  .schedule-item.type-lecture .schedule-subject {
    color: #4b5563;
  }
  
  /* ImportantLecture - gradient between exercise blue and lecture gray */
  .schedule-item.type-important-lecture {
    background: linear-gradient(135deg, #e5e7eb 0%, #a3a4f8 110%);
    border-left: 4px solid #646c7e;
  }
  
  .schedule-item.type-important-lecture:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(107,114,128,0.3);
  }
  
  .schedule-item.type-important-lecture .schedule-subject {
    color: #374151;
  }
  
  /* –ö–æ–ª–æ–∫–≤–∏—É–º - vibrant purple */
  .schedule-item.type-exam {
    background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%);
    border-left: 4px solid #a855f7;
  }
  
  .schedule-item.type-exam:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(168,85,247,0.4);
  }
  
  .schedule-item.type-exam .schedule-subject {
    color: #7e22ce;
  }

  /* –ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –ö–æ–ª–æ–∫–≤–∏—É–º - orange/amber */
  .schedule-item.type-makeup {
    background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
    border-left: 4px solid #f97316;
  }
  
  .schedule-item.type-makeup:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(249,115,22,0.4);
  }
  
  .schedule-item.type-makeup .schedule-subject {
    color: #c2410c;
  }
  
  /* –¢–µ—Å—Ç - vibrant green */
  .schedule-item.type-test {
    background: linear-gradient(135deg, #d1fae5 0%, #6ee7b7 100%);
    border-left: 4px solid #10b981;
  }
  
  .schedule-item.type-test:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(16,185,129,0.4);
  }
  
  .schedule-item.type-test .schedule-subject {
    color: #047857;
  }

  /* Highlight - –¥–æ–±–∞–≤—è —Å–≤–µ—Ç–µ—â –µ—Ñ–µ–∫—Ç */
  .schedule-item.highlight {
    box-shadow: 0 0 12px rgba(255, 193, 7, 0.6), 0 2px 8px rgba(0,0,0,0.1) !important;
    border-right: 3px solid #fbbf24;
  }
  
  .schedule-item:last-child {
    margin-bottom: 0;
  }
  
  .schedule-subject {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
  }
  
  .schedule-time {
    font-size: 12px;
    color: #6b7280;
    font-weight: 500;
  }

  /* Current day highlight */
  .schedule-table td.current-day {
    background-color: #d2e3fc; /* –º–Ω–æ–≥–æ —Å–≤–µ—Ç–ª–æ —Å–∏–Ω—å–æ */
  }
  


  /* Modal overlay */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 5000;
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
  }
  
  .modal-overlay.open {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .modal-content {
    background: #fff;
    border-radius: 16px;
    padding: 32px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    animation: slideIn 0.3s ease;
    position: relative;
  }
  
  @keyframes slideIn {
    from {
      transform: translateY(-50px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  .modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    background: none;
    border: none;
    font-size: 28px;
    color: #6b7280;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s;
  }
  
  .modal-close:hover {
    background: #f3f4f6;
    color: #000;
  }
  
  /* Exam card styles */
  .exam-card {
    background: #fff;
    border-radius: 12px;
    padding: 12px 14px 14px 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid #7c3aed;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .exam-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transform: translateY(-2px);
  }
  
  .exam-card-header {
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e5e7eb;
  }
  
  .exam-card-title {
    color: #7c3aed;
    font-size: 16px;
    font-weight: 700;
    margin: 0;
  }
  
  .exam-card-subtitle {
    color: #6b7280;
    font-size: 13px;
    margin: 0;
  }
  
  .exam-section {
    margin-bottom: 10px;
  }
  
  .exam-section:last-child {
    margin-bottom: 0;
  }
  
  .exam-section-title {
    color: #374151;
    font-size: 15px;
    font-weight: 700;
    margin: 6px 0 6px 0;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .exam-section-icon {
    width: 20px;
    height: 20px;
    fill: currentColor;
  }
  
  .exam-info-row {
    display: flex;
    justify-content: space-between;
    padding: 4px 8px;
    background: #f9fafb;
    border-radius: 4px;
    margin-bottom: 3px;
    gap: 12px;
  }
  
  .exam-info-row:last-child {
    margin-bottom: 0;
  }
  
  .exam-info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 0;
  }
  
  .exam-info-item {
    display: flex;
    flex-direction: column;
    padding: 4px 8px;
    background: #f9fafb;
    border-radius: 4px;
  }
  
  .exam-info-label {
    color: #6b7280;
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 3px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .exam-info-value {
    color: #111827;
    font-size: 13.5px;
    font-weight: 500;
    text-align: left;
  }
  
  /* Show line break after "–∏" only on mobile */
  .mobile-break {
    display: none;
  }
  
  @media (max-width: 768px) {
    .mobile-break {
      display: block;
    }
  }
  
  .modal-title {
    margin: 0 0 8px 0;
    color: #7c3aed;
    font-size: 1.8em;
    font-weight: 700;
  }
  
  .modal-type {
    display: inline-block;
    background: #ede9fe;
    color: #6d28d9;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 0.9em;
    font-weight: 600;
    margin-bottom: 20px;
  }
  
  .modal-info {
    margin: 16px 0;
  }
  
  .modal-info-row {
    display: flex;
    align-items: flex-start;
    margin-bottom: 12px;
    gap: 12px;
  }
  
  .modal-info-icon {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    fill: #7c3aed;
  }
  
  .modal-info-label {
    font-weight: 600;
    color: #374151;
    min-width: 100px;
  }
  
  .modal-info-value {
    color: #6b7280;
    flex: 1;
  }
  
  #modalAdditionalInfo {
    color: #374151;  /* –ü–æ-—Ç—ä–º–µ–Ω —Å–∏–≤ –æ—Ç –¥—Ä—É–≥–∏—Ç–µ */
    font-weight: 500;
    font-size: 14px;
    max-height: 70vh;
    overflow-y: auto;
    padding-right: 8px;
  }
  
  #modalAdditionalInfo::-webkit-scrollbar {
    width: 8px;
  }
  
  #modalAdditionalInfo::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 10px;
  }
  
  #modalAdditionalInfo::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 10px;
  }
  
  #modalAdditionalInfo::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  /* Table styles for markdown tables */
  #modalAdditionalInfo table {
    width: 100%;
    border-collapse: collapse;
    margin: 4px 0;
    font-size: 12px;
    table-layout: fixed;
  }

  #modalAdditionalInfo table thead {
    background-color: #f3f4f6;
  }

  #modalAdditionalInfo table th,
  #modalAdditionalInfo table td {
    border: 1px solid #d1d5db;
    padding: 6px 4px;
    text-align: left;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  #modalAdditionalInfo table th {
    font-weight: 700;
    color: #111827;
    background-color: #f3f4f6;
    font-size: 11px;
  }

  #modalAdditionalInfo table tbody tr:nth-child(odd) {
    background-color: #fafbfc;
  }

  #modalAdditionalInfo table tbody tr:hover {
    background-color: #f0f4f8;
  }

  #examAdditionalInfo table {
    width: 100%;
    border-collapse: collapse;
    margin: 4px 0;
    font-size: 12px;
    table-layout: fixed;
  }

  #examAdditionalInfo table thead {
    background-color: #f3f4f6;
  }

  #examAdditionalInfo table th,
  #examAdditionalInfo table td {
    border: 1px solid #d1d5db;
    padding: 6px 4px;
    text-align: left;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  #examAdditionalInfo table th {
    font-weight: 700;
    color: #111827;
    background-color: #f3f4f6;
    font-size: 11px;
  }

  #examAdditionalInfo table tbody tr:nth-child(odd) {
    background-color: #fafbfc;
  }

  #examAdditionalInfo table tbody tr:hover {
    background-color: #f0f4f8;
  }

  /* Calculator styles */
  .calc-input-group {
    margin-bottom: 12px;
  }

  .calc-input-group label {
    display: block;
    margin-bottom: 4px;
    font-weight: 600;
    color: #555;
    font-size: 13px;
  }

  .calc-input-group input,
  .calc-input-group select {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
    font-size: 13px;
  }

  .calc-input-group input:focus,
  .calc-input-group select:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 4px rgba(52, 152, 219, 0.3);
  }

  #calcResult.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  #calcResult.warning {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeeba;
  }
  
  /* Mobile responsive */
  @media (max-width: 768px) {
    #side-menu {
      transform: translateX(-100%);
      transition: transform 0.3s;
      z-index: 3200;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    #side-menu.mobile-open {
      transform: translateX(0);
    }
    
    /* Prevent body scroll when menu is open */
    body.menu-open {
      overflow: hidden;
      position: fixed;
      width: 100%;
    }
    
    /* Mobile menu overlay */
    .mobile-menu-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 3100;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .mobile-menu-overlay.active {
      display: block;
      opacity: 1;
    }
    
    .main-content {
      padding: 0;
      width: 100%;
      overflow-x: hidden;
    }
    
    .main-header {
      justify-content: flex-start;
      padding-left: 75px;
      padding-right: 12px;
    }
    
    .schedule-container {
      margin: 1rem 12px;
      overflow-x: auto;
      max-width: 100%;
      -webkit-overflow-scrolling: touch;
    }
    
    .week-selector {
      flex-wrap: wrap;
      gap: 12px;
      padding: 12px;
    }
    
    .week-btn {
      font-size: 13px;
      padding: 8px 12px;
    }
    
    .week-info {
      text-align: center;
      min-width: 100%;
      order: -1;
      margin-bottom: 8px;
    }
    
    .schedule-table {
      min-width: 100%;
      width: 100%;
      font-size: 13px;
    }
    
    .schedule-table th {
      padding: 12px 4px;
      font-size: 13px;
    }
    
    .schedule-table td {
      padding: 6px 4px;
      min-width: 0;
    }
    
    .schedule-item {
      padding: 8px;
      font-size: 12px;
      margin: 4px 0;
    }
    
    .schedule-item-subject {
      font-size: 13px;
      margin-bottom: 4px;
    }
    
    .schedule-item-type {
      font-size: 11px;
      padding: 2px 6px;
    }
    
    .schedule-item-time,
    .schedule-item-room {
      font-size: 11px;
      margin: 2px 0;
      white-space: nowrap;
    }
    
    .schedule-time {
      white-space: nowrap !important;
    }
    
    .currentInfoPanel {
      margin: 1rem 12px;
      padding: 12px;
    }

    .info-panel-content h1 {
      font-size: 20px;
    }
    
    .info-panel-content h2 {
      font-size: 18px;
    }

    .info-panel-content h3 {
      font-size: 17px;
    }
     .info-panel-content h4 {
      font-size: 14.5px;
    }
    
    .modal-content {
      padding: 24px;
      max-width: 90%;
    }
    
    .mobile-menu-toggle {
      display: flex !important;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 44px;
      height: 44px;
      background: #fff;
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      position: fixed;
      top: 18px;
      left: 18px;
      z-index: 3300;
      padding: 0;
      transition: opacity 0.3s, visibility 0.3s;
    }
    
    .mobile-menu-toggle.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }
    
    .mobile-menu-toggle span {
      display: block;
      width: 26px;
      height: 3px;
      background: #222;
      margin: 4px 0;
      border-radius: 2px;
    }
  }

  /* Extra small screens - use letter-spacing and reduce padding */
  @media (max-width: 480px) {
    .schedule-item {
      padding: 4px 0px !important;
    }
    
    .schedule-item-subject {
      letter-spacing: -0.3px !important;
    }
    
    .schedule-item-time,
    .schedule-item-room {
      letter-spacing: -0.3px !important;
    }
    
    .schedule-time {
      font-size: 11.3px !important;
      letter-spacing: -0.25px !important;
      display: block !important;
    }
    
    .schedule-table td {
      padding: 2px 2px !important;
    }
  }
  
  @media (min-width: 769px) {
    .mobile-menu-toggle {
      display: none !important;
    }
  }
  
  .bb-inner-wrap {
    position: relative;
    height: 100%;
  }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <div id="side-menu">
      <div class="bb-inner-wrap">
        <div class="logo-header">
          <a href="https://elearn.mu-varna.bg" target="_blank" rel="noopener noreferrer">
            <img src="https://ultra.content.blackboardcdn.com/ultra/static/images/brand/blackboard_logo_white.svg" alt="Blackboard-Medical University Varna" class="logo-img">
          </a>
        </div>
        <nav class="sidebar-nav" aria-label="Main">
          <ul>
            <li class="base-navigation-button">
              <a href="https://elearn.mu-varna.bg/ultra/institution-page">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/icon-institution-custom.svg" alt="Institution Page" />
                <span class="link-text">Institution Page</span>
              </a>
            </li>
            <li class="base-navigation-button">
              <a href="https://elearn.mu-varna.bg/ultra/profile">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/icon-profile-custom.svg" alt="Profile" />
                <span class="link-text">–ü—Ä–æ—Ñ–∏–ª</span>
              </a>
            </li>
            <li class="base-navigation-button">
              <a href="https://elearn.mu-varna.bg/ultra/stream">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/icon-activity-custom.svg" alt="Activity" />
                <span class="link-text">Activity</span>
              </a>
            </li>
            <li class="base-navigation-button">
              <a href="index.html">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/icon-courses-book.svg" alt="Courses" />
                <span class="link-text">Courses</span>
              </a>
            </li>
            <li class="base-navigation-button active">
              <a href="calendar.html">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/icon-calendar-custom.svg" alt="Calendar" />
                <span class="link-text">Calendar</span>
              </a>
            </li>
            <li class="base-navigation-button">
              <a href="https://elearn.mu-varna.bg/ultra/messages">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/svgexport-8.svg" alt="Messages" />
                <span class="link-text">Messages</span>
              </a>
            </li>
            <li class="base-navigation-button">
              <a href="https://elearn.mu-varna.bg/ultra/messages">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/icon-grades-paper.svg" alt="Grades" />
                <span class="link-text">Grades</span>
              </a>
            </li>
            <li class="base-navigation-button">
              <a href="tests.html">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/icon-tools-custom.svg" alt="Tools" />
                <span class="link-text">Tools</span>
              </a>
            </li>
            <li class="base-navigation-button">
              <a href="md-editor.html">
                <img class="svg-icon" width="22" height="22" src="elearn-mu-varna-bg/icon-signout-custom.svg" alt="Sign Out" />
                <span class="link-text">Sign Out</span>
              </a>
            </li>
          </ul>
        </nav>
        <div class="sidebar-footer-links">
          <span class="sidebar-footer-item">Privacy</span>
          <span class="sidebar-footer-item">Terms</span>
          <span class="sidebar-footer-item">Accessibility</span>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <div class="main-content">
      <header class="main-header">
        <h1 class="page-title">Calendar</h1>
      </header>

      <!-- Schedule container -->
      <div class="schedule-container">
        <!-- Week selector -->
        <div class="week-selector">
          <button class="week-btn" id="prevWeekBtn" onclick="changeWeek(-1)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/>
            </svg>
            –ü—Ä–µ–¥–∏—à–Ω–∞
          </button>
          
          <div class="week-info">
            <div id="weekDateRange">–°–µ–¥–º–∏—Ü–∞ 1</div>
            <span class="week-number" id="weekNumber">4 –Ω–æ–µ–º–≤—Ä–∏ - 8 –Ω–æ–µ–º–≤—Ä–∏ 2025</span>
          </div>
          
          <button class="week-btn" id="nextWeekBtn" onclick="changeWeek(1)">
            –°–ª–µ–¥–≤–∞—â–∞
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
            </svg>
          </button>
        </div>

        <!-- Christmas vacation screen -->
        <div id="christmasScreen" style="display: none;">
          <div style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 80px; margin-bottom: 20px;">üéÖüéÑ</div>
            <h2 style="color: #dc2626; font-size: 32px; margin-bottom: 10px;">–ö–æ–ª–µ–¥–Ω–∞ –≤–∞–∫–∞–Ω—Ü–∏—è!</h2>
            <div style="font-size: 60px;">üéÅ‚ùÑÔ∏è‚õÑ</div>
            <p style="color: #9ca3af; margin-top: 30px; font-size: 14px;">–ß–µ—Å—Ç–∏—Ç–∞ –ö–æ–ª–µ–¥–∞ –∏ –©–∞—Å—Ç–ª–∏–≤–∞ –ù–æ–≤–∞ –ì–æ–¥–∏–Ω–∞! üéâ</p>
          </div>
        </div>

        <!-- Exam period screen -->
        <div id="examScreen" style="display: none;">
          <div style="padding: 40px 20px;">
            <div id="examsList" style="display: grid; gap: 20px; max-width: 900px; margin: 0 auto;">
              <!-- Exams will be rendered here by JavaScript -->
            </div>
          </div>
        </div>

        <table class="schedule-table" id="scheduleTable">
          <thead>
            <tr id="scheduleHeader">
              <th>–ü–û–ù<br><span class="date-label"></span></th>
              <th>–í–¢<br><span class="date-label"></span></th>
              <th>–°–†<br><span class="date-label"></span></th>
              <th>–ß–ï–¢<br><span class="date-label"></span></th>
              <th>–ü–ï–¢<br><span class="date-label"></span></th>
            </tr>
          </thead>
          <tbody id="scheduleBody">
            <!-- Schedule will be rendered here -->
          </tbody>
        </table>
        
        <!-- Current Information Panel -->
        <div id="currentInfoPanel" class="info-panel">
          <div class="info-panel-content" id="infoContent">
            <!-- Markdown content will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile menu overlay -->
  <div id="mobileMenuOverlay" class="mobile-menu-overlay"></div>

  <!-- Mobile menu toggle -->
  <button id="mobileMenuToggle" class="mobile-menu-toggle" aria-label="–û—Ç–≤–æ—Ä–∏ –º–µ–Ω—é">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <!-- Modal for schedule details -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">√ó</button>
      <h2 class="modal-title" id="modalSubject"></h2>
      <span class="modal-type" id="modalType"></span>
      <div class="modal-info">
        <div class="modal-info-row">
          <svg class="modal-info-icon" viewBox="0 0 24 24">
            <path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
          </svg>
          <div>
            <div class="modal-info-label">–ß–∞—Å:</div>
            <div class="modal-info-value" id="modalTime"></div>
          </div>
        </div>
        <div class="modal-info-row" id="modalBuildingRow">
          <svg class="modal-info-icon" viewBox="0 0 24 24">
            <path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
          </svg>
          <div>
            <div class="modal-info-label">–°–≥—Ä–∞–¥–∞:</div>
            <div class="modal-info-value" id="modalBuilding"></div>
          </div>
        </div>
        <div class="modal-info-row">
          <svg class="modal-info-icon" viewBox="0 0 24 24">
            <path d="M5,3V21H11V17.5H13V21H19V3H5M7,5H9V7H7V5M11,5H13V7H11V5M15,5H17V7H15V5M7,9H9V11H7V9M11,9H13V11H11V9M15,9H17V11H15V9M7,13H9V15H7V13M11,13H13V15H11V13M15,13H17V15H15V13M7,17H9V19H7V17M15,17H17V19H15V17Z"/>
          </svg>
          <div>
            <div class="modal-info-label">–°—Ç–∞—è:</div>
            <div class="modal-info-value" id="modalRoomInfo">
              <span id="modalRoom"></span><span id="modalFloorText"></span>
            </div>
          </div>
        </div>
        <div class="modal-info-row">
          <svg class="modal-info-icon" viewBox="0 0 24 24">
            <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
          </svg>
          <div>
            <div class="modal-info-label">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª:</div>
            <div class="modal-info-value" id="modalTeacher"></div>
          </div>
        </div>
        
        <div id="modalAdditionalInfoRow" class="modal-info-row" style="display: none;">
          <svg class="modal-info-icon" viewBox="0 0 24 24">
            <path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z"/>
          </svg>
          <div>
            <div class="modal-info-label">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</div>
            <div class="modal-info-value" id="modalAdditionalInfo"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Exam Info Modal -->
  <div class="modal-overlay" id="examInfoModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeExamModal()">√ó</button>
      <h2 class="modal-title">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
      
      <!-- Calculator Section (hidden by default) -->
      <div id="calculatorSection" style="display: none; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb;">
        <h3 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 1.1em; text-align: center;">–ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä –Ω–∞ –∏–∑–ø–∏—Ç–∞</h3>
        
        <div class="calc-input-group">
          <label for="calcAnnualGrade">–ì–æ–¥–∏—à–Ω–∞ –æ—Ü–µ–Ω–∫–∞:</label>
          <input type="number" id="calcAnnualGrade" step="0.01" min="2" max="6" placeholder="–ù–∞–ø—Ä. 5.00">
        </div>

        <div class="calc-input-group">
          <label for="calcTargetGrade">–ñ–µ–ª–∞–Ω–∞ –∫—Ä–∞–π–Ω–∞ –æ—Ü–µ–Ω–∫–∞:</label>
          <select id="calcTargetGrade">
            <option value="3.50">3.50 (–î–æ–±—ä—Ä)</option>
            <option value="4.50">4.50 (–ú–Ω–æ–≥–æ –¥–æ–±—ä—Ä)</option>
            <option value="5.50">5.50 (–û—Ç–ª–∏—á–µ–Ω)</option>
          </select>
        </div>

        <button onclick="calculateExamPoints()" style="width: 100%; padding: 10px; background-color: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.95em; font-weight: bold;">–ò–∑—á–∏—Å–ª–∏</button>

        <div id="calcResult" style="margin-top: 15px; padding: 12px; border-radius: 6px; display: none; text-align: center; line-height: 1.5; font-size: 13px;"></div>
      </div>
      
      <div class="modal-info" id="examInfoContent">
        <div class="modal-info-row">
          <div id="examAdditionalInfo" style="width: 100%; line-height: 1.6; color: #374151; word-wrap: break-word; font-size: 14px; overflow: auto; max-height: 70vh;"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Schedule data loaded from schedule-data.js
    let scheduleByWeek = [];
    let currentWeekIndex = 0;
    let semesterConfig = null;

    // Use data from the global scheduleData variable
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof scheduleData !== 'undefined') {
        // Generate weeks from template and overrides
        scheduleByWeek = generateWeeksFromTemplate(scheduleData);
        semesterConfig = scheduleData.semester;
        
        // Find and set current week based on today's date
        currentWeekIndex = findCurrentWeekIndex();
        
        renderSchedule();
        updateWeekInfo();
        
        // Load current information from Markdown file
        loadCurrentInfo();
      } else {
        console.error('Schedule data not loaded');
        alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ä–∞–∑–ø–∏—Å–∞–Ω–∏–µ—Ç–æ.');
      }
    });
    
    // Load current information from Markdown file
    async function loadCurrentInfo() {
      try {
        const response = await fetch('schedule-notes.md');
        if (response.ok) {
          const markdown = await response.text();
          const html = marked.parse(markdown);
          document.getElementById('infoContent').innerHTML = html;
        }
      } catch (error) {
        console.error('Error loading current info:', error);
        // Hide panel if file doesn't exist
        document.getElementById('currentInfoPanel').style.display = 'none';
      }
    }
    
    // Find the current week index based on today's date
    function findCurrentWeekIndex() {
      const today = new Date();
      today.setHours(0, 0, 0, 0); // Reset time to midnight
      
      // Check if today is in Christmas break - show exam period instead
      if (semesterConfig && semesterConfig.christmasBreak) {
        const christmasStart = new Date(semesterConfig.christmasBreak.start);
        const christmasEnd = new Date(semesterConfig.christmasBreak.end);
        christmasStart.setHours(0, 0, 0, 0);
        christmasEnd.setHours(0, 0, 0, 0);
        
        if (today >= christmasStart && today <= christmasEnd) {
          // Find exam period week
          for (let i = 0; i < scheduleByWeek.length; i++) {
            const weekStart = new Date(scheduleByWeek[i].startDate);
            weekStart.setHours(0, 0, 0, 0);
            
            if (semesterConfig.examPeriod) {
              const examStart = new Date(semesterConfig.examPeriod.start);
              examStart.setHours(0, 0, 0, 0);
              
              if (weekStart >= examStart) {
                return i; // Return first exam week
              }
            }
          }
        }
      }
      
      // Check if today is Saturday (6) or Sunday (0)
      const dayOfWeek = today.getDay();
      let targetDate = new Date(today);
      
      if (dayOfWeek === 0) {
        // Sunday - show next week (add 1 day to Monday)
        targetDate.setDate(targetDate.getDate() + 1);
      } else if (dayOfWeek === 6) {
        // Saturday - show next week (add 2 days to Monday)
        targetDate.setDate(targetDate.getDate() + 2);
      }
      
      for (let i = 0; i < scheduleByWeek.length; i++) {
        const weekStart = new Date(scheduleByWeek[i].startDate);
        weekStart.setHours(0, 0, 0, 0);
        
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekEnd.getDate() + 4); // End of week (Friday)
        
        if (targetDate >= weekStart && targetDate <= weekEnd) {
          return i;
        }
      }
      
      // If today is before first week, return 0
      const firstWeek = new Date(scheduleByWeek[0].startDate);
      if (targetDate < firstWeek) {
        return 0;
      }
      
      // If today is after all weeks, return last week
      return scheduleByWeek.length - 1;
    }
    
    // Generate schedule for all weeks from template
    function generateWeeksFromTemplate(config) {
      const weeks = [];
      const template = config.template || [];
      const overrides = config.overrides || {};
      
      config.weeks.forEach((week, index) => {
        const weekNumber = index + 1;
        let schedule = JSON.parse(JSON.stringify(template)); // Deep copy
        
        // Apply overrides for this week if they exist
        if (overrides[weekNumber]) {
          overrides[weekNumber].forEach(override => {
            if (override.removeDay) {
              // Remove all items for this day
              schedule = schedule.filter(item => item.day !== override.removeDay);
            } else if (override.remove) {
              // Remove the matching item
              schedule = schedule.filter(item => 
                !(item.day === override.day && 
                  item.subject === override.subject && 
                  item.startTime === override.startTime)
              );
            } else if (override.changes) {
              // Check if item should be removed
              if (override.changes.removed === true) {
                schedule = schedule.filter(item => 
                  !(item.day === override.day && 
                    item.subject === override.subject && 
                    item.startTime === override.startTime)
                );
              } else {
                // Modify existing item
                const index = schedule.findIndex(item => 
                  item.day === override.day && 
                  item.subject === override.subject && 
                  item.startTime === override.startTime
                );
                if (index !== -1) {
                  // Apply changes
                  Object.assign(schedule[index], override.changes);
                }
              }
            } else {
              // Add new item
              schedule.push(override);
            }
          });
        }
        
        weeks.push({
          weekNumber: weekNumber,
          startDate: week.startDate,
          schedule: schedule
        });
      });
      
      return weeks;
    }
    
    // Calculate week number from semester start
    function getWeekNumberFromSemesterStart(dateStr) {
      if (!semesterConfig) return 1;
      
      const weekDate = new Date(dateStr);
      const semesterStart = new Date(semesterConfig.startDate);
      
      // Calculate difference in days
      const diffTime = weekDate - semesterStart;
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      
      // Calculate week number (starting from 1)
      return Math.floor(diffDays / 7) + 1;
    }
    
    // Check if date is in Christmas break
    function isChristmasBreak(dateStr) {
      if (!semesterConfig || !semesterConfig.christmasBreak) return false;
      
      const date = new Date(dateStr);
      const breakStart = new Date(semesterConfig.christmasBreak.start);
      const breakEnd = new Date(semesterConfig.christmasBreak.end);
      
      return date >= breakStart && date <= breakEnd;
    }
    
    // Check if date is in exam period
    function isExamPeriod(dateStr) {
      if (!semesterConfig || !semesterConfig.examPeriod) return false;
      
      const date = new Date(dateStr);
      const examStart = new Date(semesterConfig.examPeriod.start);
      const examEnd = new Date(semesterConfig.examPeriod.end);
      
      return date >= examStart && date <= examEnd;
    }
    
    // Get week type (normal, christmas, exam)
    function getWeekType(dateStr) {
      if (isChristmasBreak(dateStr)) return 'christmas';
      if (isExamPeriod(dateStr)) return 'exam';
      return 'normal';
    }

    // Render schedule table
    // Helper function to format time
    function formatTime(startTime, endTime) {
      // Remove leading zero from hours for display
      const formatHour = (time) => {
        const [hours, minutes] = time.split(':');
        return `${parseInt(hours)}:${minutes}`;
      };
      
      return `${formatHour(startTime)}-${formatHour(endTime)}`;
    }
    
    // Get current day of week (–ü–û–ù, –í–¢, etc.) or Monday if weekend
    // Returns null if we're viewing a different week than current
    function getCurrentDay() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      // Check if today is in the currently displayed week
      const currentWeek = scheduleByWeek[currentWeekIndex];
      if (!currentWeek) return null;
      
      const weekStart = new Date(currentWeek.startDate);
      weekStart.setHours(0, 0, 0, 0);
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekEnd.getDate() + 4); // Friday
      
      // If today is not in this week, don't highlight anything
      if (today < weekStart || today > weekEnd) {
        return null;
      }
      
      const dayIndex = today.getDay(); // 0=Sunday, 1=Monday, etc.
      const days = ['–ü–û–ù', '–í–¢', '–°–†', '–ß–ï–¢', '–ü–ï–¢'];
      
      // If Saturday (6) or Sunday (0), return Monday (for current week only)
      if (dayIndex === 0 || dayIndex === 6) {
        return '–ü–û–ù';
      }
      
      // Otherwise return the current day (Monday=1 -> index 0)
      return days[dayIndex - 1];
    }
    
    function renderSchedule() {
      const days = ['–ü–û–ù', '–í–¢', '–°–†', '–ß–ï–¢', '–ü–ï–¢'];
      const currentDay = getCurrentDay();
      const tbody = document.getElementById('scheduleBody');
      tbody.innerHTML = ''; // Clear existing content
      
      // Get current week's schedule
      const currentWeek = scheduleByWeek[currentWeekIndex];
      if (!currentWeek) return;
      
      const scheduleData = currentWeek.schedule;
      
      // Group events by day
      const eventsByDay = {};
      days.forEach(day => {
        eventsByDay[day] = scheduleData
          .filter(item => item.day === day && item.startTime !== '00:00')
          .sort((a, b) => a.startTime.localeCompare(b.startTime));
      });
      
      // Find maximum number of events in a day
      const maxEvents = Math.max(...days.map(day => eventsByDay[day].length));
      
      // Map type to CSS class
      function getTypeClass(type) {
        const typeMap = {
          '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ': 'type-exercise',
          '–õ–µ–∫—Ü–∏—è': 'type-lecture',
          '–í–∞–∂–Ω–∞ –ª–µ–∫—Ü–∏—è': 'type-important-lecture',
          'ImportantLecture': 'type-important-lecture',
          '–ö–æ–ª–æ–∫–≤–∏—É–º': 'type-exam',
          '–ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –ö–æ–ª–æ–∫–≤–∏—É–º': 'type-makeup',
          '–¢–µ—Å—Ç': 'type-test'
        };
        return typeMap[type] || 'type-lecture';
      }
      
      // Create rows
      for (let i = 0; i < maxEvents; i++) {
        const row = document.createElement('tr');
        days.forEach(day => {
          const td = document.createElement('td');
          
          // Add current-day class if this is today
          if (day === currentDay) {
            td.classList.add('current-day');
          }
          
          const event = eventsByDay[day][i];
          
          if (event) {
            // Generate time display from startTime and endTime
            const displayTime = event.time || formatTime(event.startTime, event.endTime);
            
            // Add info indicator if additionalInfo exists
            const infoIndicator = event.additionalInfo ? '<span style="color: #000000; font-weight: bold; margin-left: 4px;">*</span>' : '';
            
            const item = document.createElement('div');
            item.className = 'schedule-item ' + getTypeClass(event.type);
            
            // Add highlight class if event has highlight property
            if (event.highlight) {
              item.classList.add('highlight');
            }
            
            item.innerHTML = `
              <div class="schedule-subject">${event.subject}${infoIndicator}</div>
              <div class="schedule-time">${displayTime}</div>
            `;
            item.onclick = () => openModal(event);
            td.appendChild(item);
          }
          
          row.appendChild(td);
        });
        tbody.appendChild(row);
      }
    }
    
    // Change week
    function changeWeek(direction) {
      const newIndex = currentWeekIndex + direction;
      if (newIndex >= 0 && newIndex < scheduleByWeek.length) {
        currentWeekIndex = newIndex;
        renderSchedule();
        updateWeekInfo();
      }
    }
    
    // Update week information display
    function updateWeekInfo() {
      const currentWeek = scheduleByWeek[currentWeekIndex];
      if (!currentWeek) return;
      
      // Parse start date
      const startDate = new Date(currentWeek.startDate);
      let endDate = new Date(startDate);
      
      // Check if this is week 15 (last week before Christmas) - only show Mon-Tue
      const weekNumber = currentWeekIndex + 1;
      if (weekNumber === 15) {
        endDate.setDate(endDate.getDate() + 1); // Only Tuesday (–ø–æ–Ω–µ–¥–µ–ª–Ω–∏–∫ + 1 –¥–µ–Ω = –≤—Ç–æ—Ä–Ω–∏–∫)
      } else {
        endDate.setDate(endDate.getDate() + 6); // Sunday (–ø–æ–Ω–µ–¥–µ–ª–Ω–∏–∫ + 6 –¥–Ω–∏ = –Ω–µ–¥–µ–ª—è)
      }
      
      // Get week type
      const weekType = getWeekType(currentWeek.startDate);
      
      // Format dates
      const months = ['—è–Ω—É–∞—Ä–∏', '—Ñ–µ–≤—Ä—É–∞—Ä–∏', '–º–∞—Ä—Ç', '–∞–ø—Ä–∏–ª', '–º–∞–π', '—é–Ω–∏', 
                      '—é–ª–∏', '–∞–≤–≥—É—Å—Ç', '—Å–µ–ø—Ç–µ–º–≤—Ä–∏', '–æ–∫—Ç–æ–º–≤—Ä–∏', '–Ω–æ–µ–º–≤—Ä–∏', '–¥–µ–∫–µ–º–≤—Ä–∏'];
      
      const startDay = startDate.getDate();
      const startMonth = months[startDate.getMonth()];
      const endDay = endDate.getDate();
      const endMonth = months[endDate.getMonth()];
      const year = startDate.getFullYear();
      
      // Calculate actual week number from semester start
      const actualWeekNumber = getWeekNumberFromSemesterStart(currentWeek.startDate);
      
      // Update display based on week type
      const weekDateRangeEl = document.getElementById('weekDateRange');
      const weekNumberEl = document.getElementById('weekNumber');
      
      // Get special screens
      const christmasScreen = document.getElementById('christmasScreen');
      const examScreen = document.getElementById('examScreen');
      const scheduleTable = document.getElementById('scheduleTable');
      
      if (weekType === 'christmas') {
        // Christmas break - show special screen
        weekDateRangeEl.textContent = 'üéÑ –ö–æ–ª–µ–¥–Ω–∞ –≤–∞–∫–∞–Ω—Ü–∏—è';
        weekDateRangeEl.style.color = '#dc2626';
        
        // Hide table, show Christmas screen
        scheduleTable.style.display = 'none';
        examScreen.style.display = 'none';
        christmasScreen.style.display = 'block';
        
        // Show full Christmas break range
        const christmasStart = new Date(semesterConfig.christmasBreak.start);
        const christmasEnd = new Date(semesterConfig.christmasBreak.end);
        const christmasStartDay = christmasStart.getDate();
        const christmasStartMonth = months[christmasStart.getMonth()];
        const christmasStartYear = christmasStart.getFullYear();
        const christmasEndDay = christmasEnd.getDate();
        const christmasEndMonth = months[christmasEnd.getMonth()];
        const christmasEndYear = christmasEnd.getFullYear();
        
        if (christmasStartMonth === christmasEndMonth && christmasStartYear === christmasEndYear) {
          weekNumberEl.textContent = `${christmasStartDay} - ${christmasEndDay} ${christmasStartMonth} ${christmasStartYear}`;
        } else {
          weekNumberEl.textContent = `${christmasStartDay} ${christmasStartMonth} ${christmasStartYear} - ${christmasEndDay} ${christmasEndMonth} ${christmasEndYear}`;
        }
        
        return; // Skip normal rendering
      } else if (weekType === 'exam') {
        // Exam period - show special screen
        weekDateRangeEl.textContent = 'üìù –ò–∑–ø–∏—Ç–Ω–∞ —Å–µ—Å–∏—è';
        weekDateRangeEl.style.color = '#7c3aed';
        
        // Hide table, show exam screen
        scheduleTable.style.display = 'none';
        christmasScreen.style.display = 'none';
        examScreen.style.display = 'block';
        
        // Render exams
        renderExams();
        
        // Show full month range
        const examStart = new Date(semesterConfig.examPeriod.start);
        const examEnd = new Date(semesterConfig.examPeriod.end);
        const examStartDay = examStart.getDate();
        const examStartMonth = months[examStart.getMonth()];
        const examEndDay = examEnd.getDate();
        const examEndMonth = months[examEnd.getMonth()];
        
        if (examStartMonth === examEndMonth) {
          weekNumberEl.textContent = `${examStartDay} - ${examEndDay} ${examStartMonth} ${year}`;
        } else {
          weekNumberEl.textContent = `${examStartDay} ${examStartMonth} - ${examEndDay} ${examEndMonth} ${year}`;
        }
        
        return; // Skip normal rendering
      } else {
        // Normal week - show table, hide special screens
        scheduleTable.style.display = 'table';
        christmasScreen.style.display = 'none';
        examScreen.style.display = 'none';
        
        // Normal week - show week number from semester start
        weekDateRangeEl.textContent = `–°–µ–¥–º–∏—Ü–∞ ${actualWeekNumber}`;
        weekDateRangeEl.style.color = '#374151';
      }
      
      // Show date range
      if (startMonth === endMonth) {
        weekNumberEl.textContent = 
          `${startDay} - ${endDay} ${startMonth} ${year}`;
      } else {
        weekNumberEl.textContent = 
          `${startDay} ${startMonth} - ${endDay} ${endMonth} ${year}`;
      }
      
      // Update dates in table header
      updateTableHeaderDates(startDate);
      
      // Update button states
      document.getElementById('prevWeekBtn').disabled = currentWeekIndex === 0;
      document.getElementById('nextWeekBtn').disabled = currentWeekIndex === scheduleByWeek.length - 1;
    }
    
    // Update dates in table header
    function updateTableHeaderDates(startDate) {
      const headerCells = document.querySelectorAll('#scheduleHeader th .date-label');
      const headerThs = document.querySelectorAll('#scheduleHeader th');
      const days = ['–ü–û–ù', '–í–¢', '–°–†', '–ß–ï–¢', '–ü–ï–¢'];
      const currentDay = getCurrentDay();
      
      for (let i = 0; i < 5; i++) {
        const date = new Date(startDate);
        date.setDate(date.getDate() + i);
        
        const day = date.getDate();
        const month = date.getMonth() + 1; // Month is 0-indexed
        
        headerCells[i].textContent = `${day}.${month < 10 ? '0' + month : month}`;
        
        // Add current-day class if this is today
        if (days[i] === currentDay) {
          headerThs[i].classList.add('current-day');
        } else {
          headerThs[i].classList.remove('current-day');
        }
      }
    }

    // Open exam info modal
    function showExamModal(exam) {
      const examAdditionalInfo = document.getElementById('examAdditionalInfo');
      
      if (exam.additionalInfo && exam.additionalInfo.trim()) {
        examAdditionalInfo.innerHTML = marked.parse(exam.additionalInfo);
      } else {
        examAdditionalInfo.innerHTML = '–ù—è–º–∞ –¥–æ–±–∞–≤–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.';
      }
      
      // Show/hide calculator based on flag
      const calculatorSection = document.getElementById('calculatorSection');
      if (exam.hasCalculatorPharmacology1) {
        calculatorSection.style.display = 'block';
      } else {
        calculatorSection.style.display = 'none';
      }
      
      document.getElementById('examInfoModal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeExamModal() {
      document.getElementById('examInfoModal').classList.remove('open');
      document.body.style.overflow = '';
    }

    // Calculator function
    function calculateExamPoints() {
      const scoreScale = [
        {pts: "60-61", val: 3.00}, {pts: "62-63", val: 3.10}, {pts: "64-65", val: 3.20},
        {pts: "66-67", val: 3.30}, {pts: "68-69", val: 3.40}, {pts: "70", val: 3.50},
        {pts: "71", val: 3.60}, {pts: "72", val: 3.70}, {pts: "73", val: 3.80},
        {pts: "74", val: 3.90}, {pts: "75", val: 4.00}, {pts: "76", val: 4.10},
        {pts: "77", val: 4.20}, {pts: "78", val: 4.30}, {pts: "79", val: 4.40},
        {pts: "80", val: 4.50}, {pts: "81", val: 4.60}, {pts: "82", val: 4.70},
        {pts: "83", val: 4.80}, {pts: "84", val: 4.90}, {pts: "85", val: 5.00},
        {pts: "86", val: 5.10}, {pts: "87", val: 5.20}, {pts: "88", val: 5.30},
        {pts: "89", val: 5.40}, {pts: "90-91", val: 5.50}, {pts: "92-93", val: 5.60},
        {pts: "94-95", val: 5.70}, {pts: "96-97", val: 5.80}, {pts: "98", val: 5.90},
        {pts: "99-100", val: 6.00}
      ];

      const annual = parseFloat(document.getElementById('calcAnnualGrade').value);
      const target = parseFloat(document.getElementById('calcTargetGrade').value);
      const resultDiv = document.getElementById('calcResult');

      if (isNaN(annual) || annual < 2 || annual > 6) {
        resultDiv.textContent = '–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –≤–∞–ª–∏–¥–Ω–∞ –≥–æ–¥–∏—à–Ω–∞ –æ—Ü–µ–Ω–∫–∞ –º–µ–∂–¥—É 2 –∏ 6.';
        resultDiv.className = 'warning';
        resultDiv.style.display = 'block';
        return;
      }

      const neededExamGrade = (target - (0.3 * annual)) / 0.7;
      
      let foundPoints = "";
      for (let entry of scoreScale) {
        if (entry.val >= neededExamGrade) {
          foundPoints = entry.pts;
          break;
        }
      }

      resultDiv.style.display = "block";
      if (foundPoints === "" && neededExamGrade > 6) {
        resultDiv.className = "warning";
        resultDiv.innerHTML = `–ó–∞ —Å—ä–∂–∞–ª–µ–Ω–∏–µ, —Ü–µ–ª—Ç–∞ –æ—Ç <strong>${target.toFixed(2)}</strong> –µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º–∞ —Å –≥–æ–¥–∏—à–Ω–∞ –æ—Ü–µ–Ω–∫–∞ ${annual.toFixed(2)}.`;
      } else if (neededExamGrade <= 3.00) {
        resultDiv.className = "success";
        resultDiv.innerHTML = `–¢—ä–π –∫–∞—Ç–æ –≥–æ–¥–∏—à–Ω–∞—Ç–∞ –í–∏ –æ—Ü–µ–Ω–∫–∞ –µ –≤–∏—Å–æ–∫–∞, –í–∏ —Ç—Ä—è–±–≤–∞—Ç —Å–∞–º–æ –º–∏–Ω–∏–º–∞–ª–Ω–∏—Ç–µ <strong>60 —Ç–æ—á–∫–∏</strong>, –∑–∞ –¥–∞ –ø—Ä–µ–º–∏–Ω–µ—Ç–µ –∏–∑–ø–∏—Ç–∞.`;
      } else {
        const actualScaleGrade = scoreScale.find(e => e.pts === foundPoints).val;
        resultDiv.className = "success";
        resultDiv.innerHTML = `–ó–∞ –∫—Ä–∞–π–Ω–∞ –æ—Ü–µ–Ω–∫–∞ <strong>${target.toFixed(2)}</strong>,<br>–Ω–∞ –∏–∑–ø–∏—Ç–∞ –í–∏ —Ç—Ä—è–±–≤–∞—Ç –º–∏–Ω–∏–º—É–º:<br><span style="font-size: 1.3em;"><strong>${foundPoints} —Ç–æ—á–∫–∏</strong></span><br>(–¢–æ–≤–∞ —Å—ä–æ—Ç–≤–µ—Ç—Å—Ç–≤–∞ –Ω–∞ <strong>${actualScaleGrade.toFixed(2)}</strong> –æ—Ç —Ç–µ—Å—Ç–∞ –Ω–∞ –∏–∑–ø–∏—Ç–∞)`;
      }
    }

    // Close exam modal on overlay click
    document.getElementById('examInfoModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeExamModal();
      }
    });

    // Close exam modal on Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('examInfoModal').classList.contains('open')) {
        closeExamModal();
      }
    });

    // Open modal with event details
    function openModal(event) {
      // Use fullName if available, otherwise use subject
      const displayName = event.fullName || event.subject;
      document.getElementById('modalSubject').textContent = displayName;
      document.getElementById('modalType').textContent = event.type || '-';
      
      // Generate time from startTime and endTime
      const displayTime = event.time || formatTime(event.startTime, event.endTime);
      document.getElementById('modalTime').textContent = displayTime;
      
      document.getElementById('modalBuilding').textContent = event.building || '–ù–µ –µ –ø–æ—Å–æ—á–µ–Ω–∞';
      
      // Handle room and floor
      const room = event.room || '–ù–µ –µ –ø–æ—Å–æ—á–µ–Ω–∞';
      const floor = event.floor;
      document.getElementById('modalRoom').textContent = room;
      
      // Only show floor if it's not empty and not "-"
      if (floor && floor !== '-' && floor !== '') {
        document.getElementById('modalFloorText').textContent = ` (–ï—Ç–∞–∂ ${floor})`;
      } else {
        document.getElementById('modalFloorText').textContent = '';
      }
      
      document.getElementById('modalTeacher').textContent = event.teacher || '–ù–µ –µ –ø–æ—Å–æ—á–µ–Ω';
      
      // Handle additional info
      const additionalInfoElement = document.getElementById('modalAdditionalInfo');
      const additionalInfoRow = document.getElementById('modalAdditionalInfoRow');
      
      if (event.additionalInfo) {
        additionalInfoElement.innerHTML = marked.parse(event.additionalInfo);
        additionalInfoRow.style.display = 'flex';  // –ü—Ä–æ–º–µ–Ω–µ–Ω–æ –Ω–∞ flex
      } else {
        additionalInfoRow.style.display = 'none';
      }
      
      document.getElementById('modalOverlay').classList.add('open');
      document.body.style.overflow = 'hidden';
    }    // Close modal
    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('open');
      document.body.style.overflow = '';
    }
    
    // Render exams list
    function renderExams() {
      const examsList = document.getElementById('examsList');
      if (!scheduleData.exams || scheduleData.exams.length === 0) {
        examsList.innerHTML = '<p style="text-align: center; color: #6b7280;">–ù—è–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∏–∑–ø–∏—Ç–∏.</p>';
        return;
      }
      
      const months = ['—è–Ω—É–∞—Ä–∏', '—Ñ–µ–≤—Ä—É–∞—Ä–∏', '–º–∞—Ä—Ç', '–∞–ø—Ä–∏–ª', '–º–∞–π', '—é–Ω–∏', 
                      '—é–ª–∏', '–∞–≤–≥—É—Å—Ç', '—Å–µ–ø—Ç–µ–º–≤—Ä–∏', '–æ–∫—Ç–æ–º–≤—Ä–∏', '–Ω–æ–µ–º–≤—Ä–∏', '–¥–µ–∫–µ–º–≤—Ä–∏'];
      
      examsList.innerHTML = scheduleData.exams.map(exam => {
        // Format exam date
        const examDate = new Date(exam.examDate);
        const examDay = examDate.getDate();
        const examMonth = months[examDate.getMonth()];
        const examYear = examDate.getFullYear();
        const examDateFormatted = `${examDay} ${examMonth} ${examYear}`;
        
        // Format retake date - handle multiple dates separated by " –∏ " (and)
        let retakeDateFormatted = '';
        if (exam.retakeDate && exam.retakeDate.includes(' –∏ ')) {
          // Multiple dates
          const retakeDates = exam.retakeDate.split(' –∏ ').map(d => d.trim());
          const formattedDates = retakeDates.map(dateStr => {
            const d = new Date(dateStr);
            if (isNaN(d.getTime())) return dateStr; // Return original if invalid
            const day = d.getDate();
            const month = months[d.getMonth()];
            const year = d.getFullYear();
            return `${day} ${month} ${year}`;
          });
          // Add <br> after "–∏" for mobile devices
          retakeDateFormatted = formattedDates.join(' –∏ <span class="mobile-break"></span>');
        } else if (exam.retakeDate) {
          // Single date
          const retakeDate = new Date(exam.retakeDate);
          if (!isNaN(retakeDate.getTime())) {
            const retakeDay = retakeDate.getDate();
            const retakeMonth = months[retakeDate.getMonth()];
            const retakeYear = retakeDate.getFullYear();
            retakeDateFormatted = `${retakeDay} ${retakeMonth} ${retakeYear}`;
          } else {
            retakeDateFormatted = exam.retakeDate;
          }
        }
        
        return `
          <div class="exam-card" onclick="showExamModal(${JSON.stringify(exam).replace(/"/g, '&quot;')})">
            <div class="exam-card-header">
              <h3 class="exam-card-title">${exam.fullName || exam.subject}</h3>
            </div>
            
            <div class="exam-section">
              <div class="exam-section-title">
                <svg class="exam-section-icon" viewBox="0 0 24 24">
                  <path d="M9,10H7V12H9V10M13,10H11V12H13V10M17,10H15V12H17V10M19,3H18V1H16V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
                </svg>
                –†–µ–¥–æ–≤–µ–Ω –∏–∑–ø–∏—Ç
              </div>
              <div class="exam-info-grid">
                <div class="exam-info-item">
                  <span class="exam-info-label">–î–∞—Ç–∞:</span>
                  <span class="exam-info-value">${examDateFormatted}</span>
                </div>
                <div class="exam-info-item">
                  <span class="exam-info-label">–ß–∞—Å:</span>
                  <span class="exam-info-value">${exam.examTime || ''}</span>
                </div>
              </div>
            </div>
            
            <div class="exam-section">
              <div class="exam-section-title">
                <svg class="exam-section-icon" viewBox="0 0 24 24">
                  <path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
                </svg>
                –ü–æ–ø—Ä–∞–≤–∫–∞
              </div>
              <div class="exam-info-grid">
                <div class="exam-info-item">
                  <span class="exam-info-label">–î–∞—Ç–∞:</span>
                  <span class="exam-info-value">${retakeDateFormatted}</span>
                </div>
                <div class="exam-info-item">
                  <span class="exam-info-label">–ß–∞—Å:</span>
                  <span class="exam-info-value">${exam.retakeTime || ''}</span>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Close modal on outside click
    document.getElementById('modalOverlay').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
      }
    });

    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() {
      const mobileToggle = document.getElementById('mobileMenuToggle');
      const sidebar = document.getElementById('side-menu');
      const overlay = document.getElementById('mobileMenuOverlay');
      
      function closeMobileMenu() {
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('active');
        mobileToggle.classList.remove('hidden');
        document.body.classList.remove('menu-open');
        document.body.style.overflow = '';
      }
      
      if (mobileToggle && sidebar && overlay) {
        mobileToggle.addEventListener('click', function() {
          sidebar.classList.toggle('mobile-open');
          overlay.classList.toggle('active');
          mobileToggle.classList.toggle('hidden');
          // Add/remove menu-open class on body to prevent scrolling
          if (sidebar.classList.contains('mobile-open')) {
            document.body.classList.add('menu-open');
            document.body.style.overflow = 'hidden';
          } else {
            document.body.classList.remove('menu-open');
            document.body.style.overflow = '';
          }
        });
        
        // Close menu when clicking on overlay
        overlay.addEventListener('click', closeMobileMenu);
        
        // Close menu on link click
        sidebar.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', closeMobileMenu);
        });
      }
    });
  </script>

<!-- ============================================
         CHAT SYSTEM - Complete (Firebase REST + UI)
         ============================================ -->

<script src="js/chat.js?v=22"></script>

<!-- Chat Widget HTML -->
<div id="chat-widget" class="chat-widget">
  <button class="chat-icon" id="chat-toggle" title="–û—Ç–≤–æ—Ä–∏ —á–∞—Ç">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
    <span class="chat-badge-count" style="display: none;">0</span>
    <span class="chat-notification-pulse"></span>
  </button>

  <div class="chat-panel">
    <div class="chat-header">
      <div class="chat-header-title">
        <div style="font-size: 18px; font-weight: bold; margin: 0;">–ß–∞—Ç</div>
      </div>
      <button class="chat-close-btn" id="chat-close" title="–ó–∞—Ç–≤–æ—Ä–∏ —á–∞—Ç">‚úï</button>
    </div>

    <div class="chat-container">
      <div class="chat-messages-wrapper">
        <div class="chat-messages"></div>
      </div>
      <div class="chat-active-users"></div>
    </div>

    <div class="chat-input-area">
      <div class="chat-controls-row">
        <textarea
          class="chat-input"
          placeholder="–ù–∞–ø–∏—à–∏ —Å—ä–æ–±—â–µ–Ω–∏–µ..."
          rows="1"
          maxlength="500"
        ></textarea>
        <button class="chat-send-btn" title="–ò–∑–ø—Ä–∞—Ç–∏">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16.6915026,12.4744748 L3.50612381,13.2599618 C3.19218622,13.2599618 3.03521743,13.4170592 3.03521743,13.5741566 L1.15159189,20.0151496 C0.8376543,20.8006365 0.99,21.89 1.77946707,22.52 C2.41,22.99 3.50612381,23.1 4.13399899,22.8429026 L21.714504,14.0454487 C22.6563168,13.5741566 23.1272231,12.6315722 22.9702544,11.6889879 L4.13399899,1.16151496 C3.34915502,0.9 2.40734225,0.9 1.77946707,1.4429026 C0.994623095,2.08 0.837654326,3.0226 1.15159189,3.97788954 L3.03521743,10.4188814 C3.03521743,10.5759788 3.34915502,10.7330762 3.50612381,10.7330762 L16.6915026,11.5185631 C16.6915026,11.5185631 17.1624089,11.5185631 17.1624089,12.0598639 C17.1624089,12.4744748 16.6915026,12.4744748 16.6915026,12.4744748 Z"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- User info (removed) -->
  </div>
</div>

<style>
#chat-widget { --chat-primary: #5d4037; --chat-secondary: #efebe9; --chat-border: #bcaaa4; --chat-text: #2c1810; --chat-text-light: #6d4c41; }
.chat-widget { position: fixed; bottom: 20px; right: 20px; z-index: 5000; font-family: 'Open Sans', Arial, sans-serif; }
.chat-icon { width: 56px; height: 56px; border-radius: 50%; background: var(--chat-primary); color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3); transition: all 0.3s ease; position: relative; }
.chat-icon:hover { background: #4e342e; box-shadow: 0 6px 16px rgba(93, 64, 55, 0.5); transform: scale(1.1); }
.chat-badge-count { position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3); }
.chat-notification-pulse { position: absolute; top: -6px; right: -6px; width: 16px; height: 16px; background: #22c55e; border-radius: 50%; border: 2px solid white; opacity: 0; transition: opacity 0.3s ease; }
.chat-icon.has-notification .chat-notification-pulse { animation: pulse 0.6s ease-out; }
@keyframes pulse { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(1.5); } }
.chat-panel { position: fixed; bottom: 90px; right: 20px; width: 400px; height: 500px; background: white; border-radius: 12px; box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16); display: flex; flex-direction: column; opacity: 0; pointer-events: none; transform: translateY(20px); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
.chat-panel.open { opacity: 1; pointer-events: auto; transform: translateY(0); }
.chat-header { padding: 16px; border-bottom: 1px solid var(--chat-border); display: flex; justify-content: space-between; align-items: flex-start; background: var(--chat-primary); color: white; border-radius: 12px 12px 0 0; }
.chat-header-title h3 { margin: 0 0 4px 0; font-size: 16px; font-weight: 600; }
.chat-online-count { font-size: 12px; opacity: 0.9; }
.chat-close-btn { background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 20px; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; transition: background 0.2s; }
.chat-close-btn:hover { background: rgba(255, 255, 255, 0.3); }
.chat-container { display: flex; flex: 1; min-height: 0; gap: 0; }
.chat-messages-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
.chat-messages { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
.chat-message { display: flex; gap: 8px; animation: slideIn 0.3s ease; }
@keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.message-avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px; flex-shrink: 0; }
.message-content { flex: 1; display: flex; flex-direction: column; gap: 2px; }
.message-header { display: flex; gap: 8px; align-items: baseline; }
.message-author { font-weight: 600; font-size: 13px; color: var(--chat-text); }
.message-time { font-size: 11px; color: var(--chat-text-light); }
.message-text { font-size: 13px; color: var(--chat-text); word-break: break-word; background: var(--chat-secondary); padding: 8px 10px; border-radius: 8px; line-height: 1.4; }
.chat-active-users { width: 150px; padding: 12px 8px; border-left: 1px solid var(--chat-border); overflow-y: auto; background: #fafafa; display: flex; flex-direction: column; gap: 8px; min-width: 0; }
.active-users-header { font-size: 11px; font-weight: 600; color: var(--chat-text-light); padding: 0 4px; text-transform: uppercase; }
.active-user { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--chat-text); padding: 4px; border-radius: 6px; cursor: pointer; transition: background 0.2s; min-width: 0; }
.active-user:hover { background: var(--chat-secondary); }
.active-user-badge { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 11px; flex-shrink: 0; }
.active-user span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 11px; }
.chat-input-area { display: flex; gap: 8px; padding: 12px; border-top: 1px solid var(--chat-border); background: #fafafa; }
.chat-input { flex: 1; border: 1px solid var(--chat-border); border-radius: 8px; padding: 8px 12px; font-size: 13px; font-family: inherit; outline: none; transition: all 0.2s; resize: none; }
.chat-input:focus { border-color: var(--chat-primary); box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1); }
.chat-send-btn { width: 36px; height: 36px; border: none; background: var(--chat-primary); color: white; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
.chat-send-btn:hover { transform: scale(1.05); }
.chat-send-btn:active { transform: scale(0.95); }
.chat-user-info { padding: 8px 12px; font-size: 11px; color: var(--chat-text-light); border-top: 1px solid var(--chat-border); background: #fafafa; border-radius: 0 0 12px 12px; }
#current-user-name { color: var(--chat-primary); font-weight: 600; }
@media (max-width: 600px) { .chat-panel { width: calc(100vw - 40px); height: calc(100vh - 120px); bottom: 100px; right: 20px; left: 20px; max-width: none; } .chat-active-users { display: none; } .chat-widget { bottom: 10px; right: 10px; } .chat-icon { width: 48px; height: 48px; } }
.chat-messages::-webkit-scrollbar, .chat-active-users::-webkit-scrollbar { width: 6px; }
.chat-messages::-webkit-scrollbar-track, .chat-active-users::-webkit-scrollbar-track { background: transparent; }
.chat-messages::-webkit-scrollbar-thumb, .chat-active-users::-webkit-scrollbar-thumb { background: var(--chat-border); border-radius: 3px; }
.chat-messages::-webkit-scrollbar-thumb:hover, .chat-active-users::-webkit-scrollbar-thumb:hover { background: var(--chat-text-light); }
</style>

</body>
</html>
