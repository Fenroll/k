<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Markdown Editor</title>
    <!-- Include the Quill library -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        body { font-family: sans-serif; }
        .container {
            max-width: 900px;
            margin: 2rem auto;
        }

        /* Custom styles for Quill editor content */
        .ql-editor { 
            font-family: "Open Sans", Arial, sans-serif; 
            line-height: 1.8; 
            color: #1f2937;
            min-height: 60vh; 
            border: 1px solid #ccc;
            white-space: pre-wrap;
        }
        .ql-editor h1, .ql-editor h2, .ql-editor h3, .ql-editor h4 { 
            font-weight: 600; 
            margin-top: 0.8em;
            margin-bottom: 0.3em;
            color: #7c2d12;
        }
        .ql-editor h1 { font-size: 1.5em; }
        .ql-editor h2 { font-size: 1.3em; }
        .ql-editor h3 { font-size: 1.1em; }
        .ql-editor h4 { font-size: 1.05em; }
        .ql-editor p { 
            margin: 0.7em 0; 
        }
        .ql-editor ul, .ql-editor ol { 
            margin: 0.3em 0; 
            padding-left: 1.5em; 
        }
        .ql-editor li { margin: 0.15em 0; }
        .ql-editor ul ul { list-style-type: circle; }
        .ql-editor ul ul ul { list-style-type: square; }
        .ql-editor code { 
            background: rgba(146, 64, 14, 0.1); 
            padding: 2px 6px; 
            border-radius: 3px; 
            font-family: "Courier New", monospace; 
            font-size: 0.9em; 
        }
        .ql-editor pre {
            background: rgba(255, 255, 255, 0.5);
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 0.5em 0;
            font-family: "Courier New", monospace;
        }
        .ql-editor blockquote {
            border-left: 3px solid #f59e0b;
            padding-left: 1em;
            margin: 0.5em 0;
            font-style: italic;
            color: #78350f;
        }
        .ql-editor table { 
            border-collapse: collapse; 
            margin: 0.75em 0; 
            width: 100%; 
        }
        .ql-editor th, .ql-editor td { 
            border: 1px solid rgba(146, 64, 14, 0.35); 
            padding: 6px 10px; 
            text-align: left; 
        }
        .ql-editor thead th { 
            background: rgba(196, 127, 9, 0.08); 
            font-weight: 600; 
        }
        .ql-editor tbody tr:nth-child(odd) { 
            background: rgba(146, 64, 14, 0.03); 
        }
        .ql-editor a { 
            color: #f59e0b; 
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Quill Editor (Paste Markdown directly)</h2>

    <!-- Create the toolbar container -->
    <div id="toolbar-container">
        <span class="ql-formats">
            <select class="ql-header">
                <option value="1">Heading 1</option>
                <option value="2">Heading 2</option>
                <option value="3">Heading 3</option>
                <option selected>Normal</option>
            </select>
        </span>
        <span class="ql-formats">
            <button class="ql-bold"></button>
            <button class="ql-italic"></button>
            <button class="ql-underline"></button>
            <button class="ql-strike"></button>
        </span>
        <span class="ql-formats">
            <button class="ql-list" value="ordered"></button>
            <button class="ql-list" value="bullet"></button>
            <button class="ql-blockquote"></button>
            <button class="ql-code-block"></button>
        </span>
        <span class="ql-formats">
            <button class="ql-link"></button>
            <button class="ql-image"></button>
        </span>
        <span class="ql-formats">
            <button class="ql-clean"></button>
        </span>
    </div>

    <!-- Create the editor container -->
    <div id="editor-container"></div>

    <div style="margin-top: 2rem;">
        <button onclick="getHtml()">Get HTML Output</button>
        <h3>HTML Output:</h3>
        <pre><code id="html-output"></code></pre>
    </div>

</div>

    <!-- Include the Quill library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- Include the Showdown library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>

    <!-- Initialize Quill editor and add logic -->
    <script>
        var quill = new Quill('#editor-container', {
            modules: {
                toolbar: '#toolbar-container'
            },
            theme: 'snow'
        });

        const converter = new showdown.Converter({
            ghCompatibleHeaderId: true,
            simpleLineBreaks: false, // Prevents <br> for single newlines
            simplifiedAutoLink: true,
            strikethrough: true,
            tables: true,
            tasklists: true
        });

        // Listen for paste events to convert markdown
        quill.root.addEventListener('paste', (event) => {
            // Get the pasted text from the clipboard
            const pastedText = (event.clipboardData || window.clipboardData).getData('text/plain');

            // Basic check if the pasted text could be markdown
            const isMarkdown = /[`*#\[\]\(\)!_-]/.test(pastedText) || pastedText.includes('\n');

            if (pastedText && isMarkdown) {
                // Stop the default paste behavior
                event.preventDefault();

                // Convert markdown to HTML
                const html = converter.makeHtml(pastedText);

                // Clean the HTML to remove empty paragraphs that can be generated from blank lines
                const cleanHtml = html.replace(/<p>\s*(<br\s*\/?>)?\s*<\/p>/g, '');

                // Get the current selection to paste at the right place
                const range = quill.getSelection(true);
                
                // Insert the converted HTML
                quill.clipboard.dangerouslyPasteHTML(range.index, cleanHtml);
            }
            // If it's not markdown, let Quill handle it
        });

        function getHtml() {
            const html = quill.root.innerHTML;
            document.getElementById('html-output').textContent = html;
        }
    </script>

</body>
</html>
